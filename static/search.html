<!DOCTYPE html>
<html>
<head>
  <title>Search Results</title>
  <link href="/static/bootstrap.min.css" rel="stylesheet">
  <script src="/static/bootstrap.bundle.min.js"></script>
</head>
<body>
  <div id="sidebar-container"></div>
  <div id="topbar-container"></div>
  <main class="container mt-4">
    <h4>Search Results</h4>
    <ul id="search-results" class="list-group"></ul>
  </main>

  <script>
    // Load shared UI
    fetch("/static/sidebar.html").then(res => res.text()).then(html => document.getElementById("sidebar-container").innerHTML = html);
    fetch("/static/topbar.html").then(res => res.text()).then(html => document.getElementById("topbar-container").innerHTML = html);

    // Run search
    const params = new URLSearchParams(window.location.search);
    const query = params.get("q");

    fetch("/api/characters")
      .then(res => res.json())
      .then(data => {
        const results = Object.entries(data).filter(([id, char]) =>
          char.name.toLowerCase().includes(query.toLowerCase()) ||
          char.persona.toLowerCase().includes(query.toLowerCase())
        );

        const ul = document.getElementById("search-results");
        if (results.length === 0) {
          ul.innerHTML = `<li class="list-group-item text-muted">No results for "${query}"</li>`;
        }

        results.forEach(([id, char]) => {
          const li = document.createElement("li");
          li.className = "list-group-item d-flex align-items-center";
          li.style.cursor = "pointer";
          li.onclick = () => location.href = `/chat?character=${id}`;
          li.innerHTML = `
            <img src="${char.picture || '/static/default.png'}" style="width: 40px; height: 40px; border-radius: 50%; margin-right: 10px;">
            <div>
              <strong>${char.name}</strong><br>
              <small class="text-muted">${char.persona}</small>
            </div>
          `;
          ul.appendChild(li);
        });
      });
  </script>
</body>
</html>
